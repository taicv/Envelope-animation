<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            function atou(b64) {
                return decodeURIComponent(escape(atob(b64)));
            }

            function utoa(data) {
                return btoa(unescape(encodeURIComponent(data)));
            }
            function copyEncoded(inputId) {
                var encoded = document.getElementById(inputId).value;
                if (!encoded) return;
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(encoded);
                } else {
                    var el = document.getElementById(inputId);
                    el.select();
                    try { document.execCommand('copy'); } catch (e) {}
                }
            }
            
            function generateImages(type) {
                var name = document.getElementById('nameInput').value;
                if (!name) {
                    alert('Please enter a name first');
                    return;
                }
                
                var encoded = utoa(name);
                
                // Display the images
                if (type === 'saigon') {
                    document.getElementById('letterImgSG').src = 'images/letter/?love=' + encoded + '';
                    document.getElementById('envelopeFrontImgSG').src = 'images/envelop-front/?love=' + encoded + '';
                    document.getElementById('imagesSectionSG').style.display = 'block';
                } else if (type === 'tuyphong') {
                    document.getElementById('letterImgTP').src = 'https://vy.taicv.com/card/images/letter/?love=' + encoded + '';
                    document.getElementById('envelopeFrontImgTP').src = 'https://vy.taicv.com/card/images/envelop-front/?love=' + encoded + '';
                    document.getElementById('imagesSectionTP').style.display = 'block';
                }
            }
            
            function generateVideo(type) {
                var name = document.getElementById('nameInput').value;
                if (!name) {
                    alert('Please enter a name first');
                    return;
                }
                
                var encoded = encodeURIComponent(utoa(name));
                var baseUrl = type === 'saigon' 
                    ? 'https://vy.taicv.com/thiep/?play=true&love=' + encoded
                    : 'https://vy.taicv.com/card/?play=true&love=' + encoded;
                
                var videoUrl = 'https://f810781d5fea.ngrok-free.app/?url=' + encodeURIComponent(baseUrl) + '&key=babb4d6ba4dcd4a952c315226bfccf6c4b86907e';
                
                // Send fetch request with ngrok header
                fetch(videoUrl, {
                    method: 'GET',
                    headers: {
                        'ngrok-skip-browser-warning': 'true'
                    }
                })
                .then(response => response.text())
                .then(data => {
                    alert('Video generation request sent successfully!');
                    console.log('Response:', data);
                })
                .catch(error => {
                    alert('Error sending video generation request: ' + error.message);
                    console.error('Error:', error);
                });
            }
        </script>
        <style>
            body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
            .field { margin-bottom: 16px; max-width: 720px; }
            label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; }
            input[type="text"] { width: 100%; padding: 10px 12px; border: 1px solid #d0d7de; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; }
            input[type="text"]:focus { border-color: #1f6feb; box-shadow: 0 0 0 3px rgba(31, 111, 235, 0.15); }
            .input-row { display: flex; gap: 8px; align-items: stretch; }
            .input-row input[type="text"] { flex: 1; }
            .input-row button { flex-shrink: 0; }
            .actions { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
            button { padding: 8px 14px; border: 1px solid #1f6feb; background: #1f6feb; color: #fff; border-radius: 8px; cursor: pointer; font-size: 14px; }
            button:hover { background: #1656c1; border-color: #1656c1; }
            button.secondary { background: #2da44e; border-color: #2da44e; }
            button.secondary:hover { background: #218838; border-color: #218838; }
            button.video { background: #6f42c1; border-color: #6f42c1; }
            button.video:hover { background: #5a32a3; border-color: #5a32a3; }
            .images-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px; }
            .image-box img { width: 100%; border: 1px solid #d0d7de; border-radius: 8px; }
            .image-label { margin: 0 0 8px; font-size: 13px; color: #666; }
            @media (max-width: 768px) {
                .input-row { flex-wrap: wrap; }
                .input-row input[type="text"] { flex: 1 1 100%; min-width: 100%; }
            }
            @media (max-width: 640px) {
                .images-grid { grid-template-columns: 1fr; }
            }
        </style>
    </head>
<body>
    <div class="field">
        <label for="nameInput">Name</label>
        <input id="nameInput" type="text" placeholder="Enter name" onkeyup="var encoded = encodeURIComponent(utoa(this.value)); document.getElementById('encodedInput').value = 'https://vy.taicv.com/thiep/?love=' + encoded; document.getElementById('encodedInput2').value = 'https://vy.taicv.com/card/?love=' + encoded;" />
    </div>

    <div class="field">
        <label for="encodedInput">Link Thiệp Sài Gòn</label>
        <div class="input-row">
            <input id="encodedInput" type="text" placeholder="Generated link" readonly onclick="this.select();" />
            <button type="button" onclick="copyEncoded('encodedInput')">Copy</button>
            <button type="button" class="secondary" onclick="generateImages('saigon')">Generate images</button>
            <button type="button" class="video" onclick="generateVideo('saigon')">Generate Video</button>
        </div>
    </div>

    <div class="field" id="imagesSectionSG" style="display: none;">
        <label>Generated Images - Sài Gòn</label>
        <div class="images-grid">
            <div class="image-box">
                <p class="image-label">Letter</p>
                <img id="letterImgSG" src="" alt="Letter" />
            </div>
            <div class="image-box">
                <p class="image-label">Envelope Front</p>
                <img id="envelopeFrontImgSG" src="" alt="Envelope Front" />
            </div>
        </div>
    </div>

    <div class="field">
        <label for="encodedInput2">Link Thiệp Tuy Phong</label>
        <div class="input-row">
            <input id="encodedInput2" type="text" placeholder="Generated link" readonly onclick="this.select();" />
            <button type="button" onclick="copyEncoded('encodedInput2')">Copy</button>
            <button type="button" class="secondary" onclick="generateImages('tuyphong')">Generate images</button>
            <button type="button" class="video" onclick="generateVideo('tuyphong')">Generate Video</button>
        </div>
    </div>

    <div class="field" id="imagesSectionTP" style="display: none;">
        <label>Generated Images - Tuy Phong</label>
        <div class="images-grid">
            <div class="image-box">
                <p class="image-label">Letter</p>
                <img id="letterImgTP" src="" alt="Letter" />
            </div>
            <div class="image-box">
                <p class="image-label">Envelope Front</p>
                <img id="envelopeFrontImgTP" src="" alt="Envelope Front" />
            </div>
        </div>
    </div>

</body>
</html>